# 프로토콜(Protocol)

컴퓨터간 데이터 통신을 원활하게 하기 위해 규정한 규약으로 신호 송신의 순서(Handshaking)나 데이터 표현법, 오류 검출법 등을 정한 것을 말한다.

## HTTP 프로토콜

한 문서에서 다른 문서로 즉시 접근할 수 있는 텍스트를 하이퍼텍스트라고 하는데 이 텍스트를 전송하는 규약을 말한다. 

## HTTP 1.1 에서 추가된 기능

1.0에서의 모호함과 성능을 개선하기 위해 1.1 이 나왔습니다. 1,0의 경우 구조는 단순하지만 연결의 설정과 해체 반복으로 인해 네트워크 혼잡에 대한 정보를 확보할 수가 없었고, 대역폭이 낮은 링크에서는 성능저하를 발생시킨다. 또한 캐시 모델이 미흡하여 동작상의 오버헤드와 캐시 데이터 관리에 문제가 많았다. 대표적으로 keepalive를 추가하여 연결의 설정과 해제의 반복을 줄이고, 캐시 제어 메커니즘이 도입되었으며, 파이프라이닝을 추가하여 동시에 여러 클라이언트와 연결을 할 수 있었으며, 요청메소드가 확장되어 PUT, DELETE 등이 추가되었다.

## HTTP 2.0에서 추가된 기능

1.1보다 웹 속도를 개선하기 위해 2.0이 등장했다. 추가된 기능으로 SSL 환경에서만 사용가능하기 때문에 보안성이 높았으며 Header의 압축을 통한 성능향상이 되었고, Server Push를 통해 클라이언트의 요청없이도 필요 데이터를 보낼 수 있게 되었다. 또한 하나의 TCP 커넥션내에서 병렬 처리를 지원하여 동시 처리가 가능해졌다. 메세지 전송 포맷도 바뀌었다. 1.1에서는 플레인텍스트 형태로 header와 body를 보냈다면 2.0에서는 바이너리로 인코딩하여 header와 body를 전송한다. 바이너리로 인코딩된 데이터를 프레임 단위로 전송하며 프레임이 모여 하나의 메세지를 보낸다. 여러 메세지는 스트림 구조로 전송되기때문에 다수의 메세지를 동시에 처리함으로써 빠른 응답속도를 보장하게 되었다.

## Keepalive

두 호스트간 통신이 일정시간 패킷교환이 없을 때 자동으로 연결이 해지되는데 이것을 막기 위해 주기적으로 패킷을 보내는것을 말한다. Keepalive는 tcp와 http프로토콜 모두에서 일어날 수 있다.

## TCP에서 Keepalive

일정 시간동안 서로의 패킷 교환이 없을경우 두 지점간 상대방의 안부를 묻기위해 Payload가 없는 패킷을 주기적으로 보내는 것이다. 종단 시스템 중의 하나가 다운될 때 다른쪽 시스템만 열린 연결 상태를 정리하기 위해 사용된다.

## HTTP에서의 Keepalive

http는 비연결형 통신이기에 커넥션을 유지하지 않는다. 따라서 재요청시 커넥션을 다시 설정해야되는 비용이 크다. 이것을 해결하기 위해 Keepalive timeout내에 재요청을 하면 열려있는 커넥션을 통해 전송하는 구조가 Keepalive이다. Keepalive Timeout을 너무 오래 설정하면 다른 사용자가 연결을 못하게 됨으로 사용자가 많은 서버보다는 소수의 사람이 빠르게 인터넷을 사용하자 하는 환경에서 사용하는 것이 좋다. 

## HTTPS

표현계층(6계층)의 SSL 프로토콜 위에서 응용계층(7계층)의 HTTP 프로토콜이 실행되는 것을 말하며 HTTP Over SSL 이란 의미이다.

### HTTPS 동작 방식

응용계층(7계층)에서 HTTP 프로토콜에 따라 메세지에 데이터를 담아 표현계층(6계층)으로 보낸다. 표현계층의 SSL에 따라 메세지를 클라이언트와 주고받은 대칭키로 암호화하여 전송 계층(4계층)으로 보낸다. 전송계층에서는 TCP프로토콜에 따라 세그먼트에 메세지를 담아 클라이언트에게 보낸다. 클라이언트는 서버에서 가공한 과정의 역순으로 진행되며 표현계층에서는 서버와 주고받은 대칭키로 복화를 하여 데이터를 열어볼 수 있게 된다.